package com.example.mathbomb;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.io.Writer;
import java.util.ArrayList;
import java.util.Date;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.json.JSONTokener;

import android.content.Context;

public class JSONScoreSerializer {
	private Context mContext;
	private String mFilename;
	private static final String JSON_SCORE = "score";
	private static final String JSON_DATE = "date";
	
	private String mScore;
	private Date mDate;
	
//	public JSONScoreSerializer(Context c, String fname) {
//		mContext = c;
//		mFilename = fname;
//	}
	public JSONScoreSerializer(Context c, String score, String date) throws JSONException {
		mContext = c;
		mScore = score;
		mDate = date;
		JSONObject jsonObject = new JSONObject();
		mScore = jsonObject.getString(JSON_SCORE);
        mDate = new Date(jsonObject.getLong(JSON_DATE));
	}
	
	public void saveDetails(Record mRecords)
		throws JSONException, IOException {
		JSONObject jsonobject = new JSONObject();
		jsonobject.put(JSON_SCORE, mScore);
        jsonobject.put(JSON_DATE, mDate.getTime());
		jsonobject.put(mFilename, mRecords);
		Writer writer = null;
		try{
			OutputStream outputStream = mContext.openFileOutput(mFilename,Context.MODE_PRIVATE);
			writer = new OutputStreamWriter(outputStream);
			writer.write(jsonobject.toString());
			//writer.write(jsonArray.toString());
		}
		finally{
			if (writer != null) {
				writer.close();
			}
		}
	}

	public Record loadDetails() throws Exception {
		//Record mRecords = new Record();
		JSONObject jsonObject = new JSONObject();
		Record mRecords = new Record(jsonObject);
		BufferedReader reader = null;
		try{
			InputStream inputStream = mContext.openFileInput(mFilename);
			reader = new BufferedReader(new InputStreamReader(inputStream));	
			StringBuilder json_string = new StringBuilder();
			String line = null;	
			while ((line = reader.readLine()) != null) {
				json_string.append(line);
			}	
			jsonObject.getJSONObject(mFilename);
			jsonObject.getJSONObject(JSON_SCORE);
			jsonObject.getJSONObject(JSON_DATE);
		}
		catch(FileNotFoundException e){
			
		}
		finally{
				if (reader != null)
					reader.close();
				}
		return mRecords;
		}
}